<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VVPIET Staff Profiles</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8B5CF6">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #fff; color: #000; padding-bottom: 80px;
}
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
.header { text-align: center; padding: 30px 0; border-bottom: 2px solid #8B5CF6; position: relative; }
.header h1 { font-size: 28px; color: #8B5CF6; margin-bottom: 10px; }
.developer-btn { 
    position: absolute; 
    top: 5px; 
    right: 10px; 
    background: #8B5CF6; 
    color: #fff; 
    border: none; 
    padding: 6px 12px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-size: 12px;
    z-index: 100;
}
.developer-btn:hover { opacity: 0.9; }
.logo-section { text-align: center; margin: 30px 0; }
.logo-section img { width: 120px; height: auto; }
.logo-section p { margin-top: 15px; color: #666; font-size: 16px; }

.leadership { margin: 40px 0; }
.leadership h2 { text-align: center; color: #8B5CF6; margin-bottom: 30px; font-size: 24px; }
.leadership-grid { 
    display: flex; 
    justify-content: center; 
    gap: 20px; 
    flex-wrap: wrap;
    align-items: flex-start;
}
.leader-card { 
    text-align: center; 
    width: 140px;
    flex-shrink: 0;
}
.leader-card img { 
    width: 80px; 
    height: 80px; 
    border-radius: 50%; 
    object-fit: cover; 
    border: 2px solid #8B5CF6; 
}
.leader-card .name { font-weight: 600; margin-top: 10px; font-size: 14px; }
.leader-card .position { color: #666; font-size: 12px; margin-top: 3px; }

.dept-grid { 
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 12px; 
    margin: 40px 0;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}
.dept-btn { 
    background: #fff; 
    border: 2px solid #8B5CF6; 
    padding: 15px 10px; 
    text-align: center; 
    cursor: pointer; 
    border-radius: 8px; 
    transition: all 0.3s;
    font-size: 13px;
}
.dept-btn:hover { background: #8B5CF6; color: #fff; transform: translateY(-3px); }
.dept-btn small { display: block; margin-top: 5px; font-size: 11px; opacity: 0.8; }

/* Make last row span correctly for 2 items */
.dept-btn:nth-last-child(-n+2):nth-child(3n+1) {
    grid-column: span 1;
}

.taskbar { 
    position: fixed; bottom: 0; left: 0; right: 0; background: #fff; 
    border-top: 2px solid #8B5CF6; display: flex; justify-content: space-around; padding: 10px 0;
}
.taskbar button { 
    background: none; border: none; cursor: pointer; padding: 8px 20px; 
    font-size: 13px; color: #000; transition: color 0.3s;
}
.taskbar button:hover { color: #8B5CF6; }
.taskbar .icon { font-size: 20px; margin-bottom: 5px; }

.pwa-popup { 
    display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    z-index: 1000; max-width: 400px; border: 2px solid #8B5CF6;
}
.pwa-popup.show { display: block; }
.pwa-popup h3 { color: #8B5CF6; margin-bottom: 15px; }
.pwa-popup p { margin-bottom: 20px; color: #666; }
.pwa-buttons { display: flex; gap: 10px; }
.pwa-buttons button { 
    flex: 1; padding: 12px; border: 2px solid #8B5CF6; background: #fff; 
    cursor: pointer; border-radius: 8px; font-weight: 600;
}
.pwa-buttons button.install { background: #8B5CF6; color: #fff; }

.modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
.modal.show { display: flex; }
.modal-content { background: #fff; padding: 40px; border-radius: 15px; max-width: 500px; width: 90%; border: 2px solid #8B5CF6; position: relative; text-align: center; }
.modal-close { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 28px; cursor: pointer; color: #8B5CF6; }
.developer-img { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 20px; border: 3px solid #8B5CF6; overflow: hidden; }
.developer-img img { width: 100%; height: 100%; object-fit: cover; }
.developer-name { font-size: 24px; font-weight: 600; color: #8B5CF6; margin-bottom: 8px; }
.developer-title { color: #666; font-size: 16px; margin-bottom: 15px; }
.developer-desc { line-height: 1.6; margin-bottom: 20px; color: #333; }
.contact-icons { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
.contact-icons a { display: inline-flex; align-items: center; justify-content: center; width: 45px; height: 45px; border-radius: 50%; background: #8B5CF6; color: #fff; text-decoration: none; font-size: 20px; transition: transform 0.3s; }
.contact-icons a:hover { transform: scale(1.1); }

.tpc-section { 
    margin: 40px auto; 
    padding: 20px; 
    background: #f9f9f9; 
    border-radius: 10px; 
    border: 2px solid #8B5CF6;
    max-width: 600px;
}
.tpc-section h2 { text-align: center; color: #8B5CF6; margin-bottom: 15px; font-size: 20px; }

/* Enhanced Developer Modal and Image Zoom */
.developer-img {
    position: relative;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.developer-img:hover {
    transform: scale(1.05);
}

.developer-img img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: 4px solid #8B5CF6;
    transition: all 0.3s ease;
}

/* Image Zoom Modal */
.image-zoom-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.image-zoom-modal.show {
    opacity: 1;
    visibility: visible;
}

.image-zoom-content {
    position: relative;
    max-width: 90%;
    max-height: 90%;
    animation: zoomIn 0.3s ease;
}

.image-zoom-content img {
    width: auto;
    height: auto;
    max-width: 500px;
    max-height: 500px;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(139, 92, 246, 0.3);
}

.image-zoom-close {
    position: absolute;
    top: -15px;
    right: -15px;
    background: #8B5CF6;
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
}

.image-zoom-close:hover {
    background: #7C3AED;
    transform: scale(1.1);
}

@keyframes zoomIn {
    from {
        transform: scale(0.5);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

/* Enhanced modal styling */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.modal.show {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    transform: translateY(50px);
    transition: transform 0.3s ease;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
}

.modal.show .modal-content {
    transform: translateY(0);
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #f0f0f0;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    color: #666;
}

.modal-close:hover {
    background: #e0e0e0;
    color: #333;
    transform: scale(1.1);
}

/* Mobile specific adjustments */
@media (max-width: 480px) {
    .dept-grid {
        gap: 10px;
        max-width: 100%;
        padding: 0 10px;
    }
    
    .dept-btn {
        padding: 12px 8px;
        font-size: 12px;
    }
    
    .leader-card {
        width: 110px;
    }
    
    .leader-card img {
        width: 70px;
        height: 70px;
    }
    
    .leadership-grid {
        gap: 15px;
    }
    
    .tpc-section {
        margin: 30px 10px;
        padding: 15px;
    }
}

    </style> 
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>VVPIET Staff Profiles</h1>
            <button class="developer-btn" onclick="showDeveloperModal()">About Developer</button>
        </div>
        
        <!-- Logo Section -->
        <div class="logo-section">
            <img src="vvplogo.jpeg" alt="VVPIET Logo">
            <p>Explore staff profiles across all departments</p>
        </div>
        
        
        <!-- Departments Section -->
        <!-- Departments Section -->
<div>
    <h2 style="text-align: center; color: #8B5CF6; margin: 40px 0 30px;">Departments</h2>
    <div class="dept-grid">

        <!-- First Year -->
        <div class="dept-btn" onclick="handleDeptNavigation('FY')">
            FY<br><small>First Year</small>
        </div>

        

        <!-- Computer Science & Engineering -->
        <div class="dept-btn" onclick="handleDeptNavigation('CSE')">
            CSE<br><small>Computer Science & Engineering</small>
        </div>
        
        <!-- Artificial Intelligence & Data Science -->
        <div class="dept-btn" onclick="handleDeptNavigation('AIDS')">
            AI&DS<br><small>Artificial Intelligence & Data Science</small>
        </div>
        
        <!-- Electronics & Telecommunications -->
        <div class="dept-btn" onclick="handleDeptNavigation('ENTC')">
            ENTC<br><small>Electronics & Telecommunications</small>
        </div>
        
        <!-- Electrical Engineering -->
        <div class="dept-btn" onclick="handleDeptNavigation('EE')">
            EE<br><small>Electrical Engineering</small>
        </div>
        
        <!-- Mechanical Engineering -->
        <div class="dept-btn" onclick="handleDeptNavigation('ME')">
            ME<br><small>Mechanical Engineering</small>
        </div>
        
        <!-- Civil Engineering -->
        <div class="dept-btn" onclick="handleDeptNavigation('CE')">
            CE<br><small>Civil Engineering</small>
        </div>
        
        <!-- Bachelor of Computer Applications -->
        <div class="dept-btn" onclick="handleDeptNavigation('BCA')">
            BCA<br><small>Bachelor of Computer Applications</small>
        </div>
        
        <!-- Master of Computer Applications -->
        <div class="dept-btn" onclick="handleDeptNavigation('MCA')">
            MCA<br><small>Master of Computer Applications</small>
        </div>
    </div>
</div>

<!-- Training & Placement Section -->
<div class="tpc-section">
    <h2>Training & Placement Cell</h2>
    <div style="text-align:center;">
        <button class="dept-btn" style="display:inline-block;width:auto;min-width:250px;" onclick="handleTPONavigation()">
            View TPO Profile
        </button>
    </div>
</div>

<!-- Leadership Section -->
        <div class="leadership">
            <h2>Leadership</h2>
            <div class="leadership-grid" id="leadershipGrid">
                <div class="loading">Loading leadership...</div>
            </div>
        </div>
    
    <!-- Taskbar -->
    <!-- Taskbar -->
<div class="taskbar">
    <button onclick="location.href='index.html'">
        <div class="icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9,22 9,12 15,12 15,22"/>
            </svg>
        </div>
        <span>Home</span>
    </button>
    <button onclick="location.href='stafflogin.html'">
        <div class="icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        </div>
        <span>Profile</span>
    </button>
    <button onclick="handleAuth()">
        <div class="icon" id="authIcon">
            <!-- LOGIN ICON - Arrow pointing RIGHT (into door) -->
            <svg id="loginIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                <polyline points="10,17 15,12 10,7"/>
                <line x1="15" y1="12" x2="3" y2="12"/>
            </svg>
            <!-- LOGOUT ICON - Arrow pointing LEFT (out of door) -->
            <svg id="logoutIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display: none;">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16,17 21,12 16,7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
        </div>
        <span id="authText">Login</span>
    </button>
</div>

    
    <!-- PWA Popup -->
    <div class="pwa-popup" id="pwaPopup">
        <h3>Install VVPIET App</h3>
        <p>Access staff profiles anytime with our app!</p>
        <div class="pwa-buttons">
            <button class="install" onclick="installPWA()">Install</button>
            <button onclick="hidePWA()">Later</button>
        </div>
    </div>
    
    <!-- Enhanced Developer Modal -->
    <div class="modal" id="developerModal">
        <div class="modal-content">
            <button class="modal-close" onclick="hideDeveloperModal()">×</button>
            <div class="developer-img" onclick="showImageZoom('yahyadp.jpg', 'Yahya Mundewadi')">
                <img src="yahyadp.jpg" alt="Yahya Mundewadi">
            </div>
            <div class="developer-name">Yahya Mundewadi</div>
            <div class="developer-title">Founder of Continental Group</div>
            <div class="developer-desc">
                Passionate developer creating innovative solutions for educational institutions and businesses. 
                Specialized in modern web technologies and mobile applications.
            </div>
            <div class="contact-icons">
                <a href="mailto:ctgroupteam@gmail.com" title="Email">✉</a>
                <a href="tel:+919307426215" title="Phone">📞</a>
                <a href="https://wa.me/919307426215?text=Hello, I want to discuss a project" target="_blank" title="WhatsApp">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.206"/>
                    </svg>
                </a>
            </div>
            <p style="margin-top:20px;font-size:14px;color:#8B5CF6;font-weight:600;">Have a website/app idea? Contact me!</p>
        </div>
    </div>
    
    <!-- Image Zoom Modal -->
    <div class="image-zoom-modal" id="imageZoomModal">
        <div class="image-zoom-content">
            <button class="image-zoom-close" onclick="hideImageZoom()">×</button>
            <img id="zoomedImage" src="" alt="">
        </div>
    </div>    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const sb = supabase.createClient('https://nsnacwwcrszpjmanskti.supabase.co', 
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zbmFjd3djcnN6cGptYW5za3RpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTg2MTIsImV4cCI6MjA2ODQ5NDYxMn0.W01JADzAuGFvcAHAN6LPRIxc75J7A9Q76HIxvxkJDn4');
        
        let deferredPrompt;
        
        // Cache for fast loading
        
        let cachedDepartments = {};
        
        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (!localStorage.getItem('pwaInstalled')) {
                document.getElementById('pwaPopup').classList.add('show');
            }
        });
        
        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    localStorage.setItem('pwaInstalled', 'true');
                }
                deferredPrompt = null;
            }
            hidePWA();
        }
        
        function hidePWA() {
            document.getElementById('pwaPopup').classList.remove('show');
        }
        
        // Developer Modal Functions
        function showDeveloperModal() {
            document.getElementById('developerModal').classList.add('show');
        }
        
        function hideDeveloperModal() {
            document.getElementById('developerModal').classList.remove('show');
        }
        
        // Image Zoom Functions
        function showImageZoom(imageSrc, imageAlt) {
            const modal = document.getElementById('imageZoomModal');
            const img = document.getElementById('zoomedImage');
            
            img.src = imageSrc;
            img.alt = imageAlt;
            modal.classList.add('show');
            
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
        }
        
        function hideImageZoom() {
            document.getElementById('imageZoomModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            // Close developer modal
            if (e.target.id === 'developerModal') {
                hideDeveloperModal();
            }
            
            // Close image zoom modal
            if (e.target.id === 'imageZoomModal') {
                hideImageZoom();
            }
        });
        
        // Escape key to close modals
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideDeveloperModal();
                hideImageZoom();
            }
        });
        
        // Preload all department data for fast access
        async function preloadAllData() {
            try {
                // Load all departments with staff count
                const { data: deptStats } = await sb
                    .from('department_stats')
                    .select('*');
                
                // Update department buttons with staff counts
                deptStats?.forEach(dept => {
                    const deptBtn = Array.from(document.querySelectorAll('.dept-btn')).find(btn => 
                        btn.getAttribute('onclick').includes(dept.dept_short_name)
                    );
                    if (deptBtn) {
                        const small = deptBtn.querySelector('small');
                        if (small && dept.total_profiles > 0) {
                            small.innerHTML = `${small.textContent} <span style="color:#8B5CF6;font-weight:600;">(${dept.total_profiles} Staff)</span>`;
                        }
                    }
                });
                
                // Preload all profiles for instant access
                const { data: allProfiles } = await sb
                    .from('profile_complete')
                    .select('*')
                    .eq('is_published', true);
                
                // Cache by department
                if (allProfiles) {
                    allProfiles.forEach(profile => {
                        const deptShort = profile.department_short;
                        if (!cachedDepartments[deptShort]) {
                            cachedDepartments[deptShort] = [];
                        }
                        cachedDepartments[deptShort].push(profile);
                    });
                    
                    // Sort each department: HODs first, then by name
                    Object.keys(cachedDepartments).forEach(dept => {
                        cachedDepartments[dept].sort((a, b) => {
                            if (a.designation === 'HOD' && b.designation !== 'HOD') return -1;
                            if (b.designation === 'HOD' && a.designation !== 'HOD') return 1;
                            return a.name.localeCompare(b.name);
                        });
                    });
                }
                
            } catch (error) {
                console.error('Error preloading data:', error);
            }
        }
        
        // Department navigation with caching
        // Replace the handleDeptNavigation function with this:
function handleDeptNavigation(deptShort) {
    // Store department data in sessionStorage for next page
    if (cachedDepartments[deptShort]) {
        sessionStorage.setItem('deptProfiles', JSON.stringify(cachedDepartments[deptShort]));
        sessionStorage.setItem('currentDept', deptShort);
    }
    
    // Navigate to profiles page - this is the key redirect
    window.location.href = `profiles.html?dept=${deptShort}`;
}

// Also add this function to handle TPO navigation
// REPLACE handleTPONavigation function in index.html
async function handleTPONavigation() {
    try {
        // Get TPO ID from database
        const { data: tpo, error } = await sb
            .from('tpo')
            .select('tpo_id')
            .eq('is_active', true)
            .single();
        
        if (error || !tpo) {
            alert('TPO profile not available');
            return;
        }
        
        // Go directly to TPO profile
        window.location.href = `staff-profile.html?tpo=${tpo.tpo_id}`;
        
    } catch (error) {
        console.error('Error loading TPO:', error);
        alert('Failed to load TPO profile');
    }
}


        
        // Leadership Caching
let cachedLeadership = localStorage.getItem('leadership_cache');
let cachedLeadershipTime = localStorage.getItem('leadership_cache_time');

async function loadLeadership() {
    // Check cache (valid for 1 hour)
    if (cachedLeadership && cachedLeadershipTime) {
        const age = Date.now() - parseInt(cachedLeadershipTime);
        if (age < 3600000) { // 1 hour
            displayLeadership(JSON.parse(cachedLeadership));
            return;
        }
    }
    
    // Fetch fresh
    const { data: tpo } = await sb.from('tpo').select('*').eq('is_published', true);
    
    if (tpo && tpo.length) {
        localStorage.setItem('leadership_cache', JSON.stringify(tpo));
        localStorage.setItem('leadership_cache_time', Date.now());
        displayLeadership(tpo);
    }
}
        function displayLeadership(data) {
            const grid = document.getElementById('leadershipGrid');
            if (data && data.length > 0) {
                grid.innerHTML = data.map(l => {
                    const initials = l.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                    const avatar = l.profile_image || `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Crect fill='%238B5CF6' width='120' height='120'/%3E%3Ctext x='50%25' y='50%25' font-size='48' fill='white' text-anchor='middle' dy='.3em'%3E${initials}%3C/text%3E%3C/svg%3E`;
                    
                    return `
                        <div class="leader-card">
                            <img src="${avatar}" alt="${l.name}" onclick="showImageZoom('${avatar}', '${l.name}')" style="cursor: pointer;">
                            <div class="name">${l.name}</div>
                            <div class="position">${l.position}</div>
                            ${l.bio ? `<div class="bio">${l.bio}</div>` : ''}
                        </div>
                    `;
                }).join('');
            } else {
                grid.innerHTML = '<p style="text-align:center;color:#666;">Leadership information will be updated soon</p>';
            }
        }
        
        function handleAuth() {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            if (user) {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('user');
                    location.reload();
                }
            } else {
                location.href = 'stafflogin.html';
            }
        }
        
        function updateAuthButton() {
    const user = JSON.parse(localStorage.getItem('user') || 'null');
    const authText = document.getElementById('authText');
    const loginIcon = document.getElementById('loginIcon');
    const logoutIcon = document.getElementById('logoutIcon');
    
    if (user) {
        // User is logged in - show logout
        if (authText) authText.textContent = 'Logout';
        if (loginIcon) loginIcon.style.display = 'none';
        if (logoutIcon) logoutIcon.style.display = 'block';
    } else {
        // User is not logged in - show login
        if (authText) authText.textContent = 'Login';
        if (loginIcon) loginIcon.style.display = 'block';
        if (logoutIcon) logoutIcon.style.display = 'none';
    }
}

        
        // Initialize everything
        async function initializeApp() {
            updateAuthButton();
            await loadLeadership();
            await preloadAllData();
        }
        
        // Start the app
        initializeApp();
        
        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
        
        // Handle online/offline status
        window.addEventListener('online', () => {
            console.log('App is online');
        });
        
        window.addEventListener('offline', () => {
            console.log('App is offline');
        });
    </script>

</body>
</html>
